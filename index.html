<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Working Day Calculator</title>

  <style>
    :root{
      --bg:#111;
      --card:#181818;
      --border:#2b2b2b;
      --text:#e5e5e5;
      --muted:#a5a5a5;
      --accent:#ffffff;
    }

    *{box-sizing:border-box; margin:0; padding:0;}

    body{
      font-family:Inter, system-ui, sans-serif;
      background:#000;
      color:var(--text);
      -webkit-font-smoothing:antialiased;
    }

    .wrap{max-width:980px;margin:32px auto;padding:24px}

    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}

    .logo{
      width:56px;height:56px;border-radius:8px;
      background:#fff;color:#000;
      display:flex;align-items:center;justify-content:center;
      font-weight:700;font-size:18px;
      border:2px solid var(--text);
    }

    h1{font-size:20px;font-weight:700}
    p.lead{color:var(--muted);font-size:13px;margin-top:4px}

    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:8px;
      padding:18px;
    }

    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
    input[type=date],input[type=number],input[type=text],select{
      width:100%;
      padding:10px;
      border-radius:6px;
      border:1px solid var(--border);
      background:#111;
      color:var(--text);
      font-size:14px;
    }

    .row{display:flex;gap:10px}
    .row>*{flex:1}

    .small{font-size:12px;color:var(--muted)}
    .muted{color:var(--muted)}

    .workweek{display:flex;gap:6px;flex-wrap:wrap}
    .day{
      padding:8px 10px;
      border-radius:6px;
      background:#1a1a1a;
      cursor:pointer;
      user-select:none;
      border:1px solid var(--border);
      font-size:13px;
    }
    .day.active{
      background:#fff;
      color:#000;
      border:1px solid #fff;
    }

    button{
      cursor:pointer;
      padding:9px 12px;
      border-radius:6px;
      border:1px solid #fff;
      background:#fff;
      color:#000;
      font-weight:700;
      transition:0.15s;
    }
    button:hover{filter:invert(1)}
    button.secondary{
      background:#000;
      color:var(--muted);
      border:1px solid var(--border);
    }
    button.secondary:hover{border-color:#fff;color:#fff}

    .result{display:flex;flex-direction:column;gap:6px;margin-top:8px}
    .big{font-size:18px;font-weight:700}
    .tiny{font-size:12px;color:var(--muted)}

    .holidays{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{
      background:#111;
      padding:6px 8px;
      border-radius:12px;
      border:1px solid var(--border);
      font-size:12px;
      cursor:pointer;
    }
    .chip:hover{border-color:#fff;color:#fff}

    .history{max-height:220px;overflow:auto;margin-top:8px}
    .history-item{
      padding:8px;
      border-radius:6px;
      background:#141414;
      border:1px dashed var(--border);
      margin-bottom:8px;
      font-size:13px;
    }

    footer{margin-top:18px;color:var(--muted);font-size:13px}

    .share{display:flex;gap:8px;margin-top:8px}
    .small-muted{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      
      <div>
        <h1>Working Day Calculator</h1>
        <p class="lead">Enter a  date and a add work days like "18 working days" — get the exact date (skipping weekends & holidays).</p>
      </div>
    </header>

    <div class="grid">
      <div>
        <div class="card">
          <label for="purchase">Start date</label>
          <input id="purchase" type="date" />

          <div style="height:12px"></div>

          <label for="wdays">Working days (e.g. 18)</label>
          <input id="wdays" type="number" min="0" value="18" />

          <div style="height:12px"></div>

          <label class="small">Working week (click to toggle which days count as workdays)</label>
          <div class="workweek" id="workweek"></div>

          <div style="height:12px"></div>

          <label class="small">Holidays (optional) — add specific dates that shouldn't count as working days</label>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="holiday-input" type="date" />
            <button id="add-holiday" class="secondary">Add</button>
          </div>
          <div class="holidays" id="holidays-list" style="margin-top:10px"></div>

          <div style="height:16px"></div>

          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <label class="small-muted"><input type="checkbox" id="count-purchase" checked /> Count First date as a working day if it is one</label>
            <button id="calc">Calculate</button>
            <button id="clear-history" class="secondary">Clear history</button>
          </div>

          <div style="height:14px"></div>

          <div class="result" id="result">
            <div class="big muted">No calculation yet — enter a date and number, then click Calculate.</div>
          </div>
        </div>

        <div style="height:14px"></div>

        <div class="card">
          <h3 style="margin:0 0 8px 0">History</h3>
          <div class="history" id="history"></div>
        </div>
      </div>

      <aside>
        <div class="card">
          <h3 style="margin:0 0 6px 0">Quick examples</h3>
          <p class="small-muted">If you ordered on <strong>2025-11-20</strong> and the store says <strong>18 working days</strong>, the app will count only your selected working days and holidays to return the calendar arrival date and total days from now.</p>

          <div style="height:12px"></div>

          <h4 style="margin:0 0 8px 0">Options explained</h4>
          <ul class="small-muted" style="padding-left:18px;margin:0">
            <li><strong>Count purchase date:</strong> If checked and the purchase day is a working day, it will be counted as day 1.</li>
            <li><strong>Workweek:</strong> Toggle which weekdays count as working days (useful in countries with Saturday work).</li>
            <li><strong>Holidays:</strong> Add dates that should be skipped (local public holidays, store closed days).</li>
          </ul>

          <div style="height:12px"></div>

          <h4 style="margin:0 0 8px 0">Share or save</h4>
          <p class="small-muted">After calculation you can copy a shareable link or save the result to your device.</p>

          <div style="height:12px"></div>
          <div class="share">
            <button id="copy-link" class="secondary">Copy link</button>
            <button id="export-csv">Export CSV</button>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <h4 style="margin:0 0 8px 0">Notes</h4>
          <p class="small-muted">Check my other apps on [link to my apps soon].</p>
        </div>
      </aside>
    </div>

    <footer>Built for estimating deliveries when shipping times are given in working days. Made with ♡ by Giorgi Sapharidze.</footer>
  </div>

<script>

const $ = (id)=>document.getElementById(id);
const DAYS = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

function formatDate(d){
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  return `${yyyy}-${mm}-${dd}`;
}

function parseDate(s){
  if(!s) return null;
  const parts = s.split('-');
  if(parts.length!==3) return null;
  return new Date(parts[0], parts[1]-1, parts[2]);
}

function addWorkingDays(startDate, n, workweek, holidaysSet, countPurchase){
  let date = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
  let added = 0;

  
  if(countPurchase){
    const dow = date.getDay();
    const key = formatDate(date);
    if(workweek[dow] && !holidaysSet.has(key)){
      added++;
      if(added>=n) return date; // done
    }
  }

  while(added < n){
    date.setDate(date.getDate() + 1);
    const dow = date.getDay();
    const key = formatDate(date);
    if(workweek[dow] && !holidaysSet.has(key)){
      added++;
    }
  }
  return date;
}


function daysBetween(a,b){
  const ms = b.getTime() - a.getTime();
  return Math.round(ms / (1000*60*60*24));
}


let workweekState = [false,true,true,true,true,true,false]; 
let holidays = []; 
const HISTORY_KEY = 'wdc_history_v1';

function renderWorkweek(){
  const container = $('workweek');
  container.innerHTML = '';
  for(let i=0;i<7;i++){
    const btn = document.createElement('div');
    btn.className = 'day' + (workweekState[i] ? ' active' : '');
    btn.textContent = DAYS[i];
    btn.title = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][i];
    btn.onclick = ()=>{ workweekState[i] = !workweekState[i]; renderWorkweek(); };
    container.appendChild(btn);
  }
}

function renderHolidays(){
  const list = $('holidays-list');
  list.innerHTML = '';
  holidays.forEach(h=>{
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.textContent = h;
    chip.onclick = ()=>{
      if(confirm('Remove holiday ' + h + '?')){ holidays = holidays.filter(x=>x!==h); renderHolidays(); }
    };
    list.appendChild(chip);
  });
}

function loadHistory(){
  try{
    const raw = localStorage.getItem(HISTORY_KEY);
    return raw ? JSON.parse(raw) : [];
  }catch(e){return []}
}
function saveHistory(hist){ localStorage.setItem(HISTORY_KEY, JSON.stringify(hist.slice(0,50))); }

function renderHistory(){
  const hist = loadHistory();
  const container = $('history'); container.innerHTML='';
  if(hist.length===0){ container.innerHTML = '<div class="small-muted">No history yet.</div>'; return; }
  hist.slice().reverse().forEach(item=>{
    const div = document.createElement('div'); div.className='history-item';
    div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${item.wdays} working days</strong> from <span class="muted">${item.purchase}</span></div><div class="tiny">arrives <strong>${item.arrival}</strong></div></div><div class="small-muted">Total calendar days: ${item.calendarDays} — ${item.note||''}</div>`;
    container.appendChild(div);
  });
}

function addToHistory(entry){
  const hist = loadHistory(); hist.push(entry); saveHistory(hist); renderHistory(); }


function calculate(){
  const purchaseStr = $('purchase').value;
  const wdays = parseInt($('wdays').value,10);
  if(!purchaseStr){ alert('Please select a purchase date.'); return; }
  if(isNaN(wdays) || wdays<0){ alert('Please enter a non-negative number of working days.'); return; }

  const purchaseDate = parseDate(purchaseStr);
  const countPurchase = $('count-purchase').checked;
  const holidaysSet = new Set(holidays);
  const arrival = addWorkingDays(purchaseDate, wdays, workweekState, holidaysSet, countPurchase);
  const totalCalendarDays = daysBetween(purchaseDate, arrival);

  renderResult({purchase:purchaseStr, wdays, arrival, totalCalendarDays});

  addToHistory({purchase:purchaseStr,wdays,arrival:formatDate(arrival),calendarDays:totalCalendarDays, note: (holidays.length?holidays.length+' holiday(s)':'')});
}

function renderResult({purchase, wdays, arrival, totalCalendarDays}){
  const res = $('result'); res.innerHTML = '';
  const arrivalStr = formatDate(arrival);
  const now = new Date();
  const daysLeft = daysBetween(now, arrival);

  const big = document.createElement('div'); big.className='big'; big.textContent = `Estimated arrival: ${arrivalStr}`;
  const sub = document.createElement('div'); sub.className='tiny';
  sub.innerHTML = `${wdays} working day(s) from <strong>${purchase}</strong> → <strong>${arrivalStr}</strong><br>Total calendar days between: <strong>${totalCalendarDays}</strong>`;

  const countdown = document.createElement('div'); countdown.className='small-muted';
  countdown.id = 'countdown';
  updateCountdown(countdown, arrival);

  res.appendChild(big); res.appendChild(sub); res.appendChild(countdown);
}

function updateCountdown(node, arrival){
  function tick(){
    const now = new Date();
    const diff = arrival.getTime() - now.getTime();
    if(diff<=0){ node.innerHTML = 'The arrival date has passed or is today.'; clearInterval(node._iv); return; }
    const days = Math.floor(diff / (1000*60*60*24));
    const hrs = Math.floor(diff / (1000*60*60)) % 24;
    const mins = Math.floor(diff / (1000*60)) % 60;
    const secs = Math.floor(diff / 1000) % 60;
    node.innerHTML = `Time until arrival: ${days}d ${hrs}h ${mins}m ${secs}s`;
  }
  if(node._iv) clearInterval(node._iv);
  tick(); node._iv = setInterval(tick,1000);
}

function generateLink(){
  const purchase = $('purchase').value;
  const wdays = $('wdays').value;
  const countPurchase = $('count-purchase').checked ? '1':'0';
  const holidaysParam = holidays.join(',');
  const ww = workweekState.map(x=>x?1:0).join('');
  const q = new URLSearchParams({purchase,wdays,countPurchase,holidays:holidaysParam,ww});
  return location.origin + location.pathname + '?' + q.toString();
}

function loadFromQuery(){
  const params = new URLSearchParams(location.search);
  if(params.has('purchase')) $('purchase').value = params.get('purchase');
  if(params.has('wdays')) $('wdays').value = params.get('wdays');
  if(params.has('countPurchase')) $('count-purchase').checked = params.get('countPurchase')==='1';
  if(params.has('holidays')){ const h = params.get('holidays'); if(h) holidays = h.split(',').filter(Boolean); }
  if(params.has('ww')){ const ww = params.get('ww'); if(ww.length===7) workweekState = ww.split('').map(c=>c==='1'); }
}


function exportCSV(){
  const hist = loadHistory(); if(hist.length===0){ alert('No history to export.'); return; }
  let csv = 'purchase,working_days,arrival,calendar_days,note\n';
  hist.forEach(r=>{ csv += `${r.purchase},${r.wdays},${r.arrival},${r.calendarDays},"${(r.note||'').replace(/"/g,'""')}"\n`; });
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'wdc-history.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

renderWorkweek(); renderHolidays(); renderHistory(); loadFromQuery();

$('add-holiday').addEventListener('click', ()=>{
  const d = $('holiday-input').value; if(!d){ alert('Pick a date first'); return; }
  if(!holidays.includes(d)){ holidays.push(d); renderHolidays(); $('holiday-input').value = ''; }
});
$('calc').addEventListener('click', calculate);
$('clear-history').addEventListener('click', ()=>{ if(confirm('Clear history?')){ saveHistory([]); renderHistory(); }});
$('copy-link').addEventListener('click', ()=>{ navigator.clipboard.writeText(generateLink()).then(()=>alert('Link copied to clipboard')); });
$('export-csv').addEventListener('click', exportCSV);


if(location.search){ setTimeout(()=>{ if($('purchase').value) calculate(); },200); }

</script>
</body>
</html>
